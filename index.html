<!DOCTYPE html>
<html>
<head>
    <title>BTCUSDT Order Book (0 to 1 Million USD)</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <style>
        body {
            background-color: #121212;
            color: #fff;
            font-family: sans-serif;
        }

        #order-book-chart {
            width: 90vw; 
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h1>BTCUSDT Order Book (0 to 1 Million USD)</h1>
    <div id="order-book-chart"></div>
    <label for="minQtyUSD">Minimum Order Size (USD):</label>
    <input type="number" id="minQtyUSD" value="1000" step="100" min="1">

    <script>
        async function fetchOrderBook() {
            try {
                const response = await axios.get('https://api.binance.com/api/v3/depth', {
                    params: {
                        symbol: 'BTCUSDT',
                        limit: 1000 
                    }
                });

                const bids = response.data.bids.map(([price, qty]) => [parseFloat(price), parseFloat(qty)]);
                const asks = response.data.asks.map(([price, qty]) => [parseFloat(price), parseFloat(qty)]);
                
                return { bids, asks };
            } catch (error) {
                console.error("Error fetching order book data:", error);
                return { bids: [], asks: [] }; 
            }
        }

        function createOrderBookChart(bids, asks, minQtyUSD) {
            const bid_prices = bids.map(([price, qty]) => price);
            const bid_quantities_usd = bids.map(([price, qty]) => price * qty); 
            const ask_prices = asks.map(([price, qty]) => price);
            const ask_quantities_usd = asks.map(([price, qty]) => price * qty);

            // Filter by minimum order size in USD
            const filtered_bids = bid_prices.map((price, index) => 
                [price, bid_quantities_usd[index]] 
            ).filter(([price, qtyUSD]) => qtyUSD >= minQtyUSD);
            const filtered_asks = ask_prices.map((price, index) => 
                [price, ask_quantities_usd[index]] 
            ).filter(([price, qtyUSD]) => qtyUSD >= minQtyUSD);

            const trace1 = {
                x: filtered_bids.map(([price, _]) => price),
                y: filtered_bids.map(([_, qty]) => qty),
                type: 'bar',
                name: 'Bids',
                marker: { color: 'green' }
            };

            const trace2 = {
                x: filtered_asks.map(([price, _]) => price),
                y: filtered_asks.map(([_, qty]) => qty),
                type: 'bar',
                name: 'Asks',
                marker: { color: 'red' }
            };

            const data = [trace1, trace2];

            const layout = {
                title: 'BTCUSDT Order Book (0 to 1 Million USD)',
                xaxis: { title: 'Price (USDT)' },
                yaxis: { title: 'Order Size (USD)' },
                barmode: 'group', 
                plot_bgcolor: '#121212', 
                paper_bgcolor: '#121212', 
                font: { color: '#fff' } 
            };

            Plotly.newPlot('order-book-chart', data, layout);
        }

        async function updateOrderBook() {
            const orderBookData = await fetchOrderBook();
            const minQtyUSD = parseFloat(document.getElementById("minQtyUSD").value);
            createOrderBookChart(orderBookData.bids, orderBookData.asks, minQtyUSD);
        }

        // Initial fetch
        updateOrderBook();

        document.getElementById("minQtyUSD").addEventListener("input", () => {
            updateOrderBook();
        });

    </script>

</body>
</html>
