<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC/USDT High Volume Order Book (±10% Range)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
        }
        h1 {
            margin: 20px 0;
        }
        .order-book-container {
            display: flex;
            justify-content: space-between;
            width: 90%;
            margin-top: 20px;
        }
        .order-book-column {
            width: 45%;
            padding: 20px;
            border: 1px solid #333;
            background-color: #222;
        }
        .order-book-column h2 {
            text-align: center;
            color: #00FF00; /* Bids color */
        }
        .ask-column h2 {
            color: #FF0000; /* Asks color */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table th, table td {
            border: 1px solid #333;
            padding: 8px;
            text-align: right;
        }
        table th {
            background-color: #444;
        }
        table tr:nth-child(even) {
            background-color: #333;
        }
        table tr:nth-child(odd) {
            background-color: #444;
        }
        .controls {
            margin: 20px 0;
        }
        label, input {
            color: white;
            font-size: 14px;
        }
        input[type="number"] {
            background-color: #333;
            color: white;
            padding: 5px;
            border: 1px solid #444;
            border-radius: 5px;
            width: 100px;
        }
    </style>
</head>
<body>
    <h1>BTC/USDT High Volume Order Book (±10% Price Range)</h1>

    <div class="controls">
        <label for="minQuantity">Minimum Quantity (BTC):</label>
        <input type="number" id="minQuantity" min="0.01" step="0.01" value="0.1">
    </div>

    <div class="order-book-container">
        <!-- Bids Column -->
        <div class="order-book-column">
            <h2>Bids (Buy Orders)</h2>
            <table id="bidsTable">
                <thead>
                    <tr>
                        <th>Price (USDT)</th>
                        <th>Quantity (BTC)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Asks Column -->
        <div class="order-book-column ask-column">
            <h2>Asks (Sell Orders)</h2>
            <table id="asksTable">
                <thead>
                    <tr>
                        <th>Price (USDT)</th>
                        <th>Quantity (BTC)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        const symbol = "BTCUSDT";
        let minQuantity = 0.1; // Default minimum quantity
        const priceRangeFactor = 0.1; // ±10% range from the mid-price
        let orderBook = { bids: [], asks: [] }; // Order book data

        // Function to fetch the order book data from Binance API
        async function fetchOrderBook() {
            try {
                const response = await fetch(`https://api.binance.com/api/v3/depth?symbol=${symbol}&limit=100`);
                const data = await response.json();
                processOrderBookData(data);
            } catch (error) {
                console.error("Error fetching order book:", error);
            }
        }

        // Function to process order book data and filter within ±10% of the mid-price
        function processOrderBookData(data) {
            const midPrice = (parseFloat(data.bids[0][0]) + parseFloat(data.asks[0][0])) / 2;
            const priceRange = {
                min: midPrice * (1 - priceRangeFactor), // 10% below the mid price
                max: midPrice * (1 + priceRangeFactor)  // 10% above the mid price
            };

            // Filter bids within the ±10% price range and volume threshold
            const filteredBids = data.bids
                .map(([price, quantity]) => ({ price: parseFloat(price), quantity: parseFloat(quantity) }))
                .filter(order => order.price >= priceRange.min && order.quantity >= minQuantity)
                .sort((a, b) => b.price - a.price); // Sort bids by price (descending)

            // Filter asks within the ±10% price range and volume threshold
            const filteredAsks = data.asks
                .map(([price, quantity]) => ({ price: parseFloat(price), quantity: parseFloat(quantity) }))
                .filter(order => order.price <= priceRange.max && order.quantity >= minQuantity)
                .sort((a, b) => a.price - b.price); // Sort asks by price (ascending)

            orderBook.bids = filteredBids;
            orderBook.asks = filteredAsks;

            updateOrderBookTables();
        }

        // Function to calculate the color based on quantity (volume)
        function getColorForOrder(quantity) {
            // Normalize the quantity for color scale (darker for larger volumes)
            const normalizedQuantity = Math.min(quantity / 5, 1); // Normalize between 0 and 1, adjust max (5 BTC in this example)
            const colorValue = Math.floor(255 * (1 - normalizedQuantity)); // Darker for higher volumes (reverse scale)
            return `rgb(${colorValue}, ${Math.floor(255 - colorValue)}, ${Math.floor(255 - colorValue)})`;
        }

        // Function to update the table with the filtered order book data
        function updateOrderBookTables() {
            const bidsTableBody = document.getElementById('bidsTable').getElementsByTagName('tbody')[0];
            const asksTableBody = document.getElementById('asksTable').getElementsByTagName('tbody')[0];

            // Clear the tables
            bidsTableBody.innerHTML = '';
            asksTableBody.innerHTML = '';

            // Populate the bids table
            orderBook.bids.forEach(order => {
                const row = bidsTableBody.insertRow();
                row.insertCell(0).textContent = order.price.toFixed(2);
                row.insertCell(1).textContent = order.quantity.toFixed(6);
                row.style.backgroundColor = getColorForOrder(order.quantity); // Apply color
            });

            // Populate the asks table
            orderBook.asks.forEach(order => {
                const row = asksTableBody.insertRow();
                row.insertCell(0).textContent = order.price.toFixed(2);
                row.insertCell(1).textContent = order.quantity.toFixed(6);
                row.style.backgroundColor = getColorForOrder(order.quantity); // Apply color
            });
        }

        // Event listener for the minimum quantity input
        document.getElementById('minQuantity').addEventListener('input', (event) => {
            minQuantity = parseFloat(event.target.value);
            fetchOrderBook(); // Re-fetch the order book with the new minimum quantity
        });

        // Fetch the initial order book data
        fetchOrderBook();
        setInterval(fetchOrderBook, 10000); // Update every 10 seconds
    </script>
</body>
</html>