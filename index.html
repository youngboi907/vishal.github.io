<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView with Binance Order Book & OI/Volume Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: white;
            overflow: hidden;
        }
        #tv_chart_container {
            position: relative;
            width: 100%;
            height: 70vh;
        }
        #orderBookContainer {
            width: 100%;
            height: 30vh;
            background-color: #1e2128;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 10px;
            box-sizing: border-box;
        }
        #oiVolumeContainer {
            width: 100%;
            height: 40vh;
            background-color: #1e2128;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 10px;
            box-sizing: border-box;
        }
        canvas {
            width: 100%;
            height: calc(100% - 40px);
        }
        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .button-container {
            margin: 20px 0;
            text-align: center;
        }
        button {
            background-color: #7289da;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #5b6eae;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div id="tv_chart_container"></div>
<div id="orderBookContainer">
    <div id="orderBookControls" class="chart-controls">
        <label for="minQty">Minimum Quantity (BTC):</label>
        <input type="number" id="minQty" value="0.001" step="0.001" min="0.000001">
    </div>
    <canvas id="orderBookChart"></canvas>
</div>
<div id="oiVolumeContainer" class="hidden">
    <canvas id="oiVolumeChart"></canvas>
</div>

<div class="button-container">
    <button id="switchButton">Switch to OI/Volume Chart</button>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
    // Initialize TradingView chart
    new TradingView.widget({
        container_id: "tv_chart_container",
        autosize: true,
        symbol: "BINANCE:BTCUSDT",
        interval: "60",
        timezone: "Etc/UTC",
        theme: "dark",
        locale: "en",
        toolbar_bg: "#1e2128",
        enable_publishing: false,
        allow_symbol_change: true,
        details: true,
        hotlist: true,
        calendar: true,
        withdateranges: true,
    });

    // Order book chart variables
    const orderBookChart = new Chart(document.getElementById("orderBookChart").getContext("2d"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Bids", data: [], backgroundColor: "rgba(76, 175, 80, 0.7)" }, { label: "Asks", data: [], backgroundColor: "rgba(244, 67, 54, 0.7)" }] },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // Switch between charts
    document.getElementById("switchButton").addEventListener("click", () => {
        const orderBookContainer = document.getElementById("orderBookContainer");
        const oiVolumeContainer = document.getElementById("oiVolumeContainer");
        const button = document.getElementById("switchButton");
        if (oiVolumeContainer.classList.contains("hidden")) {
            orderBookContainer.classList.add("hidden");
            oiVolumeContainer.classList.remove("hidden");
            button.textContent = "Switch to Order Book Chart";
        } else {
            orderBookContainer.classList.remove("hidden");
            oiVolumeContainer.classList.add("hidden");
            button.textContent = "Switch to OI/Volume Chart";
        }
    });

    // Open Interest/Volume area chart variables
    const oiVolumeChart = new Chart(document.getElementById("oiVolumeChart").getContext("2d"), {
        type: "line",
        data: {
            labels: [],
            datasets: [{
                label: "OI/Volume Ratio",
                data: [],
                fill: true,
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                borderColor: "rgba(75, 192, 192, 1)",
                tension: 0.4,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { x: { title: { display: true, text: "Time" } }, y: { title: { display: true, text: "OI/Volume Ratio" }, beginAtZero: true } }
        }
    });

    // Fetch Open Interest and Volume data
    async function fetchLiveOIandVolume() {
        // Replace with an API call to fetch Open Interest and Volume
        return { openInterest: Math.random() * 100000, volume: Math.random() * 50000 + 1 };
    }

    // Update Open Interest/Volume chart every 3 seconds
    setInterval(async () => {
        const data = await fetchLiveOIandVolume();
        const ratio = data.openInterest / data.volume;
        const time = new Date().toLocaleTimeString();
        oiVolumeChart.data.labels.push(time);
        oiVolumeChart.data.datasets[0].data.push(ratio);
        if (oiVolumeChart.data.labels.length > 20) {
            oiVolumeChart.data.labels.shift();
            oiVolumeChart.data.datasets[0].data.shift();
        }
        oiVolumeChart.update();
    }, 3000);
</script>

</body>
</html>