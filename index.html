<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC/USDT Order Book Depth</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #ffcc00;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .controls select, .controls input {
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: #2a2a2a;
            color: #fff;
        }
        .chart-container {
            width: 90%;
            max-width: 1200px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <h1>BTC/USDT Order Book Depth</h1>

    <div class="controls">
        <label for="timeframe">Select Time Frame:</label>
        <select id="timeframe">
            <option value="1m">1 Minute</option>
            <option value="5m">5 Minutes</option>
            <option value="15m">15 Minutes</option>
            <option value="1h">1 Hour</option>
            <option value="4h">4 Hours</option>
            <option value="1d">1 Day</option>
        </select>
    </div>

    <div class="chart-container">
        <canvas id="depthChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="historicalChart"></canvas>
    </div>

    <script>
        const API_URL = "https://api.binance.com/api/v3/";
        const depthCtx = document.getElementById("depthChart").getContext("2d");
        const historicalCtx = document.getElementById("historicalChart").getContext("2d");

        const depthChart = new Chart(depthCtx, {
            type: "line",
            data: {
                labels: [],
                datasets: [
                    {
                        label: "Bids (1%-2.5%)",
                        data: [],
                        borderColor: "rgba(0, 255, 0, 1)",
                        backgroundColor: "rgba(0, 255, 0, 0.2)",
                        fill: true
                    },
                    {
                        label: "Asks (1%-2.5%)",
                        data: [],
                        borderColor: "rgba(255, 0, 0, 1)",
                        backgroundColor: "rgba(255, 0, 0, 0.2)",
                        fill: true
                    },
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { labels: { color: "#fff" } }
                },
                scales: {
                    x: { ticks: { color: "#fff" }, title: { display: true, text: "Price Levels", color: "#fff" } },
                    y: { ticks: { color: "#fff" }, title: { display: true, text: "Cumulative Volume", color: "#fff" } }
                }
            }
        });

        const historicalChart = new Chart(historicalCtx, {
            type: "line",
            data: {
                labels: [],
                datasets: [
                    {
                        label: "Bids Volume (1%-2.5%)",
                        data: [],
                        borderColor: "rgba(0, 200, 255, 1)",
                        backgroundColor: "rgba(0, 200, 255, 0.2)",
                        fill: true
                    },
                    {
                        label: "Asks Volume (1%-2.5%)",
                        data: [],
                        borderColor: "rgba(255, 165, 0, 1)",
                        backgroundColor: "rgba(255, 165, 0, 0.2)",
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { labels: { color: "#fff" } }
                },
                scales: {
                    x: { ticks: { color: "#fff" }, title: { display: true, text: "Time", color: "#fff" } },
                    y: { ticks: { color: "#fff" }, title: { display: true, text: "Volume", color: "#fff" } }
                }
            }
        });

        async function fetchOrderBook(symbol) {
            const response = await fetch(`${API_URL}depth?symbol=${symbol}&limit=1000`);
            return response.ok ? response.json() : null;
        }

        async function fetchHistoricalData(symbol, interval) {
            const response = await fetch(`${API_URL}klines?symbol=${symbol}&interval=${interval}&limit=50`);
            return response.ok ? response.json() : null;
        }

        async function updateDepthData() {
            const orderBook = await fetchOrderBook("BTCUSDT");
            if (!orderBook) return;

            const topBid = parseFloat(orderBook.bids[0][0]);
            const topAsk = parseFloat(orderBook.asks[0][0]);
            const midPrice = (topBid + topAsk) / 2;

            const bids = orderBook.bids
                .map(([price, volume]) => ({ price: parseFloat(price), volume: parseFloat(volume) }))
                .filter(bid => bid.price >= midPrice * 0.975 && bid.price <= midPrice * 0.99);

            const asks = orderBook.asks
                .map(([price, volume]) => ({ price: parseFloat(price), volume: parseFloat(volume) }))
                .filter(ask => ask.price >= midPrice * 1.01 && ask.price <= midPrice * 1.025);

            depthChart.data.labels = [...bids.map(b => b.price), ...asks.map(a => a.price)];
            depthChart.data.datasets[0].data = bids.map(b => b.volume);
            depthChart.data.datasets[1].data = asks.map(a => a.volume);

            depthChart.update();
        }

        async function updateHistoricalData(interval) {
            const historicalData = await fetchHistoricalData("BTCUSDT", interval);
            if (!historicalData) return;

            const timestamps = historicalData.map(candle => new Date(candle[0]).toLocaleString());
            const bidsVolume = historicalData.map(candle => parseFloat(candle[5])); // Using volume as a proxy for bids
            const asksVolume = historicalData.map(candle => parseFloat(candle[7])); // Using trades as a proxy for asks

            historicalChart.data.labels = timestamps;
            historicalChart.data.datasets[0].data = bidsVolume;
            historicalChart.data.datasets[1].data = asksVolume;

            historicalChart.update();
        }

        document.getElementById("timeframe").addEventListener("change", async (e) => {
            const interval = e.target.value;
            await updateHistoricalData(interval);
        });

        // Initial load
        updateDepthData();
        updateHistoricalData("1h");
        setInterval(updateDepthData, 1000); // Update live data every second
    </script>
</body>
</html>