<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTCUSDT Order Book Depth Sums (1% to 2.5%)</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <style>
        body {
            background-color: #121212;
            color: #fff;
        }
    </style>
</head>
<body>
    <h1>BTCUSDT Order Book Depth Sums (1% to 2.5%)</h1>
    <div id="chart"></div>
    <div id="result">
        <p>Bid Sum: <span id="bidSum1_2_5"></span></p>
        <p>Ask Sum: <span id="askSum1_2_5"></span></p>
        <p>Delta: <span id="delta1_2_5"></span></p> 
    </div>

    <script>
        // Sample order book data (replace with actual data)
        const bids = [
            [100.1, 10], 
            [100.05, 5], 
            [100, 8], 
            [99.95, 12], 
            [99.9, 7],
            [99.8, 3],
            [99.7, 2],
            [99.6, 1]
        ];

        const asks = [
            [100.2, 15], 
            [100.25, 8], 
            [100.3, 10], 
            [100.35, 12], 
            [100.4, 5],
            [100.5, 3],
            [100.6, 2],
            [100.7, 1] 
        ];

        // Calculate mid-price
        const mid_price = (bids[0][0] + asks[0][0]) / 2;

        function calculateDepthSums(bids, asks, mid_price) {
            const lower_bound = mid_price * 0.99;
            const upper_bound = mid_price * 1.01;

            const filtered_bids = bids.filter(([price, _]) => price >= lower_bound && price <= upper_bound);
            const filtered_asks = asks.filter(([price, _]) => price >= lower_bound && price <= upper_bound);

            const bid_sum = filtered_bids.reduce((acc, curr) => acc + curr[1], 0);
            const ask_sum = filtered_asks.reduce((acc, curr) => acc + curr[1], 0);
            const delta = ask_sum - bid_sum;

            return { bid_sum, ask_sum, delta };
        }

        function createChart(bid_sum, ask_sum) {
            const data = [
                {
                    x: ['Bids (1-2.5%)', 'Asks (1-2.5%)'], 
                    y: [bid_sum, ask_sum],
                    type: 'bar',
                    marker: { color: ['green', 'red'] }
                }
            ];

            const layout = {
                title: 'BTCUSDT Order Book Depth Sums (1% to 2.5% around Mid-Price)',
                xaxis: { title: 'Order Book Side' },
                yaxis: { title: 'Order Quantity Sum' },
                plot_bgcolor: '#121212', 
                paper_bgcolor: '#121212', 
                font: { color: '#fff' } 
            };

            Plotly.newPlot('chart', data, layout);
        }

        // Calculate and display depth sums and delta
        const { bid_sum, ask_sum, delta } = calculateDepthSums(bids, asks, mid_price);
        document.getElementById('bidSum').textContent = bid_sum;
        document.getElementById('askSum').textContent = ask_sum;
        document.getElementById('delta').textContent = delta; 
        createChart(bid_sum, ask_sum); 

    </script>

</body>
</html>
