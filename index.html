<!DOCTYPE html>
<html>
<head>
    <title>BTCUSDT Order Book Depth Sums</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script> 
</head>
<body>
    <h1>BTCUSDT Order Book Depth Sums (1% to 2.5% around Mid-Price)</h1>
    <div id="chart"></div>
    <div id="result">
        <p>Bid Sum: <span id="bidSum"></span></p>
        <p>Ask Sum: <span id="askSum"></span></p>
    </div>

    <script>
        // Sample order book data (replace with actual data)
        const bids = [
            [100.1, 10], 
            [100.05, 5], 
            [100, 8], 
            [99.95, 12], 
            [99.9, 7] 
        ];

        const asks = [
            [100.2, 15], 
            [100.25, 8], 
            [100.3, 10], 
            [100.35, 12], 
            [100.4, 5] 
        ];

        // Calculate mid-price
        const mid_price = (bids[0][0] + asks[0][0]) / 2;

        function calculateDepthSums(bids, asks, mid_price) {
            const lower_bound_1 = mid_price * 0.99;
            const upper_bound_1 = mid_price * 1.01;
            const lower_bound_2_5 = mid_price * 0.975;
            const upper_bound_2_5 = mid_price * 1.025;

            const filtered_bids = bids.filter(([price, _]) => price >= lower_bound_1 && price <= upper_bound_2_5);
            const filtered_asks = asks.filter(([price, _]) => price >= lower_bound_1 && price <= upper_bound_2_5);

            const bid_sum = filtered_bids.reduce((acc, curr) => acc + curr[1], 0);
            const ask_sum = filtered_asks.reduce((acc, curr) => acc + curr[1], 0);

            return { bid_sum, ask_sum };
        }

        function createChart(bid_sum, ask_sum) {
            const data = [
                {
                    x: ['Bids', 'Asks'],
                    y: [bid_sum, ask_sum],
                    type: 'bar',
                    marker: { color: ['green', 'red'] }
                }
            ];

            const layout = {
                title: 'BTCUSDT Order Book Depth Sums (1% to 2.5% around Mid-Price)',
                xaxis: { title: 'Order Book Side' },
                yaxis: { title: 'Order Quantity Sum' }
            };

            Plotly.newPlot('chart', data, layout);
        }

        // Calculate and display initial depth sums
        const { bid_sum, ask_sum } = calculateDepthSums(bids, asks, mid_price);
        document.getElementById('bidSum').textContent = bid_sum;
        document.getElementById('askSum').textContent = ask_sum;
        createChart(bid_sum, ask_sum);

    </script>

</body>
</html>
