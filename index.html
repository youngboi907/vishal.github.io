<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC/USDT Chart with Volume Deltas & Leverage Insights</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        h1, select {
            margin: 10px 0;
        }
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        canvas {
            max-width: 90%;
            max-height: 400px;
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>BTC/USDT Chart & Binance Insights</h1>
    <label for="timeframe">Select Time Frame:</label>
    <select id="timeframe">
        <option value="1h">Last 1 Hour</option>
        <option value="4h">Last 4 Hours</option>
        <option value="1d">Last 1 Day</option>
        <option value="7d">Last 7 Days</option>
        <option value="30d">Last 30 Days</option>
    </select>
    <div class="chart-container">
        <canvas id="btcChart"></canvas>
        <canvas id="spotDeltaChart"></canvas>
        <canvas id="futuresDeltaChart"></canvas>
        <canvas id="openInterestChart"></canvas>
        <canvas id="fundingRatesChart"></canvas>
    </div>

    <script>
        const apiBaseUrl = "https://api.binance.com";
        const futuresApiBaseUrl = "https://fapi.binance.com";

        // Chart instances
        let btcChart, spotDeltaChart, futuresDeltaChart, openInterestChart, fundingRatesChart;

        // Fetch data for Binance Futures Open Interest & Funding Rates
        async function fetchFuturesData(symbol, interval, limit) {
            const openInterestUrl = `${futuresApiBaseUrl}/futures/data/openInterestHist?symbol=${symbol}&period=${interval}&limit=${limit}`;
            const fundingRateUrl = `${futuresApiBaseUrl}/futures/data/fundingRate?symbol=${symbol}&limit=${limit}`;

            const [openInterestRes, fundingRateRes] = await Promise.all([
                fetch(openInterestUrl),
                fetch(fundingRateUrl)
            ]);

            const openInterestData = await openInterestRes.json();
            const fundingRateData = await fundingRateRes.json();

            const timestamps = openInterestData.map(data => new Date(data.timestamp).toLocaleString());
            const openInterestValues = openInterestData.map(data => parseFloat(data.sumOpenInterest));
            const fundingRatesValues = fundingRateData.map(data => parseFloat(data.fundingRate));

            return { timestamps, openInterestValues, fundingRatesValues };
        }

        // Fetch spot volume delta or futures volume delta
        async function fetchVolumeDelta(symbol, interval, limit, isFutures = false) {
            const baseUrl = isFutures ? futuresApiBaseUrl : apiBaseUrl;
            const url = `${baseUrl}/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
            const response = await fetch(url);
            const data = await response.json();

            const timestamps = [];
            const deltas = [];

            for (const [time, open, high, low, close, volume] of data) {
                timestamps.push(new Date(time).toLocaleString());
                const delta = parseFloat(volume); // Simulated delta
                deltas.push(delta);
            }

            return { timestamps, deltas };
        }

        // Fetch candlestick data
        async function fetchKlineData(symbol, interval, limit) {
            const url = `${apiBaseUrl}/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
            const response = await fetch(url);
            const data = await response.json();

            const timestamps = [];
            const prices = [];

            for (const [time, open, high, low, close] of data) {
                timestamps.push(new Date(time).toLocaleString());
                prices.push({
                    open: parseFloat(open),
                    high: parseFloat(high),
                    low: parseFloat(low),
                    close: parseFloat(close)
                });
            }

            return { timestamps, prices };
        }

        // Create the charts
        function createCharts() {
            const btcCtx = document.getElementById("btcChart").getContext("2d");
            const spotDeltaCtx = document.getElementById("spotDeltaChart").getContext("2d");
            const futuresDeltaCtx = document.getElementById("futuresDeltaChart").getContext("2d");
            const openInterestCtx = document.getElementById("openInterestChart").getContext("2d");
            const fundingRatesCtx = document.getElementById("fundingRatesChart").getContext("2d");

            btcChart = new Chart(btcCtx, { type: "candlestick", data: { datasets: [] }, options: {} });
            spotDeltaChart = new Chart(spotDeltaCtx, { type: "bar", data: { datasets: [] }, options: {} });
            futuresDeltaChart = new Chart(futuresDeltaCtx, { type: "bar", data: { datasets: [] }, options: {} });
            openInterestChart = new Chart(openInterestCtx, { type: "line", data: { datasets: [] }, options: {} });
            fundingRatesChart = new Chart(fundingRatesCtx, { type: "line", data: { datasets: [] }, options: {} });
        }

        // Update the charts with data
        async function updateCharts(interval, limit) {
            const symbol = "BTCUSDT";
            const klineData = await fetchKlineData(symbol, interval, limit);
            const spotDeltaData = await fetchVolumeDelta(symbol, interval, limit);
            const futuresDeltaData = await fetchVolumeDelta(symbol, interval, limit, true);
            const futuresData = await fetchFuturesData(symbol, interval, limit);

            // Update BTC/USDT chart
            btcChart.data.labels = klineData.timestamps;
            btcChart.data.datasets = [{ label: "BTC/USDT Price", data: klineData.prices }];
            btcChart.update();

            // Update Spot Delta chart
            spotDeltaChart.data.labels = spotDeltaData.timestamps;
            spotDeltaChart.data.datasets = [{ label: "Spot Volume Delta", data: spotDeltaData.deltas }];
            spotDeltaChart.update();

            // Update Futures Delta chart
            futuresDeltaChart.data.labels = futuresDeltaData.timestamps;
            futuresDeltaChart.data.datasets = [{ label: "Futures Volume Delta", data: futuresDeltaData.deltas }];
            futuresDeltaChart.update();

            // Update Open Interest chart
            openInterestChart.data.labels = futuresData.timestamps;
            openInterestChart.data.datasets = [{ label: "Open Interest", data: futuresData.openInterestValues }];
            openInterestChart.update();

            // Update Funding Rates chart
            fundingRatesChart.data.labels = futuresData.timestamps;
            fundingRatesChart.data.datasets = [{ label: "Funding Rates", data: futuresData.fundingRatesValues }];
            fundingRatesChart.update();
        }

        // Timeframe selector
        document.getElementById("timeframe").addEventListener("change", (e) => {
            const value = e.target.value;
            let interval, limit;
            switch (value) {
                case "1h": interval = "1m"; limit = 60; break;
                case "4h": interval = "5m"; limit = 48; break;
                case "1d": interval = "15m"; limit = 96; break;
                case "7d": interval = "1h"; limit = 168; break;
                case "30d": interval = "4h"; limit = 180; break;
                default: interval = "1m"; limit = 60; break;
            }
            updateCharts(interval, limit);
        });

        // Initialize
        createCharts();
        updateCharts("1m", 60);
    </script>
</body>
</html>