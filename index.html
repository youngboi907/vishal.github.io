<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTCUSDT Order Book Depth Sums</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <style>
        body {
            background-color: #121212;
            color: #fff;
        }
    </style>
</head>
<body>
    <h1>BTCUSDT Order Book Depth Sums</h1>
    <div id="chart"></div>

    <script>
        // Sample order book data (replace with actual data)
        const bids = [
            [100.1, 10], 
            [100.05, 5], 
            [100, 8], 
            [99.95, 12], 
            [99.9, 7],
            [99.8, 3],
            [99.7, 2],
            [99.6, 1]
        ];

        const asks = [
            [100.2, 15], 
            [100.25, 8], 
            [100.3, 10], 
            [100.35, 12], 
            [100.4, 5],
            [100.5, 3],
            [100.6, 2],
            [100.7, 1] 
        ];

        // Calculate mid-price
        const mid_price = (bids[0][0] + asks[0][0]) / 2;

        function calculateDepthSums(bids, asks, mid_price) {
            const ranges = [
                { lower: mid_price * 0.99, upper: mid_price * 1.01 },
                { lower: mid_price * 0.975, upper: mid_price * 1.025 },
                { lower: mid_price * 0.95, upper: mid_price * 1.05 },
                { lower: mid_price * 0.90, upper: mid_price * 1.10 }
            ];

            const results = {};

            for (let i = 0; i < ranges.length; i++) {
                const { lower, upper } = ranges[i];
                const filtered_bids = bids.filter(([price, _]) => price >= lower && price <= upper);
                const filtered_asks = asks.filter(([price, _]) => price >= lower && price <= upper);

                const bid_sum = filtered_bids.reduce((acc, curr) => acc + curr[1], 0);
                const ask_sum = filtered_asks.reduce((acc, curr) => acc + curr[1], 0);
                const delta = ask_sum - bid_sum;

                results[`bidSum${i + 1}_${i + 2}`] = bid_sum;
                results[`askSum${i + 1}_${i + 2}`] = ask_sum;
                results[`delta${i + 1}_${i + 2}`] = delta;
            }

            return results;
        }

        function createChart(results) {
            const labels = [
                'Bids (1-2.5%)', 'Asks (1-2.5%)', 
                'Bids (2.5-5%)', 'Asks (2.5-5%)', 
                'Bids (5-10%)', 'Asks (5-10%)'
            ];

            const data = [
                {
                    x: labels,
                    y: [
                        results.bidSum1_2_5, 
                        results.askSum1_2_5, 
                        results.bidSum2_5_5, 
                        results.askSum2_5_5, 
                        results.bidSum5_10, 
                        results.askSum5_10
                    ],
                    type: 'bar',
                    marker: { color: ['green', 'red', 'lightgreen', 'pink', 'darkgreen', 'magenta'] }
                }
            ];

            const layout = {
                title: 'BTCUSDT Order Book Depth Sums',
                xaxis: { title: 'Order Book Side' },
                yaxis: { title: 'Order Quantity Sum' },
                plot_bgcolor: '#121212', 
                paper_bgcolor: '#121212', 
                font: { color: '#fff' } 
            };

            Plotly.newPlot('chart', data, layout);
        }

        // Calculate and display depth sums and deltas
        const results = calculateDepthSums(bids, asks, mid_price);

        // Display results in the HTML (you can customize this part)
        for (const key in results) {
            const elementId = key.toLowerCase();
            const valueElement = document.getElementById(elementId);
            if (valueElement) {
                valueElement.textContent = results[key];
            }
        }

        createChart(results); 

    </script>

</body>
</html>
