<script>
    const exchanges = [
        { name: "Binance", url: "https://api.binance.com/api/v3/trades?symbol=BTCUSDT&limit=500", parser: parseBinance },
        { name: "Bybit", url: "https://api.bybit.com/v2/public/trading-records?symbol=BTCUSDT&limit=500", parser: parseBybit },
        { name: "Kraken", url: "https://api.kraken.com/0/public/Trades?pair=XBTUSDT", parser: parseKraken },
        { name: "Bitstamp", url: "https://www.bitstamp.net/api/v2/transactions/btcusd/", parser: parseBitstamp }
    ];

    async function fetchData(exchange) {
        try {
            const response = await fetch(exchange.url);
            if (!response.ok) {
                console.error(`Failed to fetch data from ${exchange.name}:`, response.statusText);
                return { buyVolume: 0, sellVolume: 0 };
            }
            const data = await response.json();
            return exchange.parser(data);
        } catch (error) {
            console.error(`Error fetching data from ${exchange.name}:`, error);
            return { buyVolume: 0, sellVolume: 0 };
        }
    }

    async function aggregateVolumeDelta() {
        let totalBuyVolume = 0, totalSellVolume = 0;

        for (const exchange of exchanges) {
            const { buyVolume, sellVolume } = await fetchData(exchange);
            console.log(`${exchange.name}: Buy=${buyVolume}, Sell=${sellVolume}`);
            totalBuyVolume += buyVolume;
            totalSellVolume += sellVolume;
        }

        const delta = totalBuyVolume - totalSellVolume;
        console.log(`Total Buy Volume: ${totalBuyVolume}, Total Sell Volume: ${totalSellVolume}, Delta: ${delta}`);
        return delta;
    }
</script>