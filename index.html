<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC Trading Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        .container {
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            margin: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            flex: 1 1 calc(50% - 40px);
            max-width: calc(50% - 40px);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .result {
            background: #2c2c2c;
            border: 1px solid #444;
            padding: 10px;
            margin-top: 20px;
            border-radius: 8px;
        }
        label, p {
            margin-right: 10px;
        }
        input[type="number"] {
            width: 80px;
            padding: 5px;
            font-size: 14px;
            background-color: #2a2d36;
            color: white;
            border: 1px solid #3a3f4b;
            border-radius: 5px;
            outline: none;
            transition: all 0.2s ease-in-out;
        }
        input[type="number"]:focus {
            border-color: #7289da;
            box-shadow: 0 0 5px rgba(114, 137, 218, 0.5);
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px auto 0;
            display: block;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <!-- Order Book & OI/Volume Ratio Section -->
    <div class="container">
        <h1>BTCUSDT Order Book (0 to 1 Million USD)</h1>
        <div id="order-book-chart"></div>
        <label for="minQtyUSD">Minimum Order Size (USD):</label>
        <input type="number" id="minQtyUSD" value="1000" step="100" min="1">
        <div class="result">
            <h2>BTCUSDT OI/Volume Ratio</h2>
            <p>OI/Volume Ratio: <span id="oiVolumeRatio">Loading...</span></p>
        </div>
    </div>

    <!-- Futures Leverage Calculator -->
    <div class="container">
        <h1>BTC Futures Leverage Calculator</h1>
        <p>This tool fetches live data from Binance to calculate the leverage used in BTC futures trading, updated every 5 seconds.</p>
        <div id="result" class="result">
            <p><strong>Funding Rate:</strong> <span id="fundingRate">Loading...</span></p>
            <p><strong>Long-Short Ratio:</strong> <span id="longShortRatio">Loading...</span></p>
            <p><strong>Estimated Leverage:</strong> <span id="leverage">Calculating...</span></p>
        </div>
        <div class="refresh-info" id="lastUpdated">Last updated: --</div>
    </div>

    <script>
        // --- Order Book Section ---
        async function fetchOrderBook() {
            try {
                const response = await axios.get('https://api.binance.com/api/v3/depth', { params: { symbol: 'BTCUSDT', limit: 1000 } });
                const bids = response.data.bids.map(([price, qty]) => [parseFloat(price), parseFloat(qty)]);
                const asks = response.data.asks.map(([price, qty]) => [parseFloat(price), parseFloat(qty)]);
                return { bids, asks };
            } catch (error) {
                console.error("Error fetching order book data:", error);
                return { bids: [], asks: [] };
            }
        }
        function filterOrderBook(bids, asks, minQtyUSD) {
            return {
                filtered_bids: bids.filter(([price, qty]) => price * qty >= minQtyUSD),
                filtered_asks: asks.filter(([price, qty]) => price * qty >= minQtyUSD),
            };
        }
        function createOrderBookChart(filtered_bids, filtered_asks) {
            const trace1 = { x: filtered_bids.map(([p]) => p), y: filtered_bids.map(([p, q]) => p * q), type: 'bar', name: 'Bids', marker: { color: 'green' } };
            const trace2 = { x: filtered_asks.map(([p]) => p), y: filtered_asks.map(([p, q]) => p * q), type: 'bar', name: 'Asks', marker: { color: 'red' } };
            Plotly.newPlot('order-book-chart', [trace1, trace2], {
                title: 'BTCUSDT Order Book (USD)',
                xaxis: { title: 'Price (USDT)' },
                yaxis: { title: 'Order Size (USD)' },
                barmode: 'group',
                plot_bgcolor: '#121212',
                paper_bgcolor: '#121212',
                font: { color: '#fff' },
            });
        }
        async function updateOrderBook() {
            const { bids, asks } = await fetchOrderBook();
            const { filtered_bids, filtered_asks } = filterOrderBook(bids, asks, parseFloat(document.getElementById("minQtyUSD").value));
            createOrderBookChart(filtered_bids, filtered_asks);
        }
        async function fetchMarketData() {
            const [ticker, oi] = await Promise.all([
                axios.get('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=BTCUSDT'),
                axios.get('https://fapi.binance.com/fapi/v1/openInterest?symbol=BTCUSDT'),
            ]);
            return { volume: parseFloat(ticker.data.volume), openInterest: parseFloat(oi.data.openInterest) };
        }
        function calculateOIVolumeRatio(volume, openInterest) {
            return volume && openInterest ? (openInterest / volume).toFixed(2) : 0;
        }
        async function updateMarketData() {
            const { volume, openInterest } = await fetchMarketData();
            document.getElementById('oiVolumeRatio').textContent = calculateOIVolumeRatio(volume, openInterest);
        }
        // --- Futures Leverage Section ---
        async function fetchFundingRate() {
            const response = await fetch("https://fapi.binance.com/fapi/v1/fundingRate?symbol=BTCUSDT&limit=1");
            return parseFloat((await response.json())[0].fundingRate);
        }
        async function fetchLongShortRatio() {
            const response = await fetch("https://fapi.binance.com/futures/data/globalLongShortAccountRatio?symbol=BTCUSDT&period=5m&limit=1");
            return parseFloat((await response.json())[0].longShortRatio);
        }
        async function updateData() {
            const [fundingRate, longShortRatio] = await Promise.all([fetchFundingRate(), fetchLongShortRatio()]);
            document.getElementById("fundingRate").textContent = fundingRate.toFixed(6);
            document.getElementById("longShortRatio").textContent = longShortRatio.toFixed(2);
            document.getElementById("leverage").textContent = ((1 + Math.abs(fundingRate)) * longShortRatio).toFixed(2);
            document.getElementById("lastUpdated").textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }
        // --- Update Intervals ---
        setInterval(updateOrderBook, 5000);
        setInterval(updateMarketData, 1000);
        setInterval(updateData, 5000);
        updateOrderBook();
        updateMarketData();
        updateData();
        document.getElementById("minQtyUSD").addEventListener("input", updateOrderBook);
    </script>
</body>
</html>