<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OI/Volume Ratio Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            overflow: hidden;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #chartContainer {
            width: 90%;
            height: 80%;
        }

        canvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<div id="chartContainer">
    <canvas id="oiVolumeChart"></canvas>
</div>

<script>
// API URLs to fetch Open Interest (OI) and Volume data
const oiUrl = 'https://fapi.binance.com/fapi/v1/openInterest?symbol=BTCUSDT';
const volumeUrl = 'https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=BTCUSDT';

let oiData = [];
let volumeData = [];
let ratioData = [];

// Fetch Open Interest and Volume data
async function fetchData() {
    try {
        // Fetch Open Interest (OI)
        const oiResponse = await fetch(oiUrl);
        const oiJson = await oiResponse.json();
        const openInterest = parseFloat(oiJson.openInterest); // Open Interest in BTC

        // Fetch 24h Volume data
        const volumeResponse = await fetch(volumeUrl);
        const volumeJson = await volumeResponse.json();
        const volume = parseFloat(volumeJson.volume); // Volume in BTC

        const ratio = openInterest / volume; // OI/Volume Ratio

        // Push data to arrays for chart
        oiData.push(openInterest);
        volumeData.push(volume);
        ratioData.push(ratio);

        // Limit data array size to last 100 data points for better performance
        if (oiData.length > 100) {
            oiData.shift();
            volumeData.shift();
            ratioData.shift();
        }

        updateChart();

    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

// Initialize the chart
let oiVolumeChart;
function updateChart() {
    const ctx = document.getElementById('oiVolumeChart').getContext('2d');

    // Initialize chart only once
    if (!oiVolumeChart) {
        oiVolumeChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({ length: ratioData.length }, (_, index) => index + 1),
                datasets: [
                    {
                        label: 'OI/Volume Ratio',
                        data: ratioData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', // Transparent fill under the line (Area effect)
                        fill: true, // Make it an area chart
                        tension: 0.1,
                    },
                    {
                        label: 'Open Interest (BTC)',
                        data: oiData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        fill: false,
                        tension: 0.1,
                    },
                    {
                        label: 'Volume (BTC)',
                        data: volumeData,
                        borderColor: 'rgba(153, 102, 255, 1)',
                        fill: false,
                        tension: 0.1,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: { display: true, text: 'Time (seconds)' },
                    },
                    y: {
                        title: { display: true, text: 'Values' },
                    }
                },
                animation: {
                    duration: 1000 // refresh every second
                }
            }
        });
    } else {
        // Update the existing chart with new data
        oiVolumeChart.data.labels = Array.from({ length: ratioData.length }, (_, index) => index + 1);
        oiVolumeChart.data.datasets[0].data = ratioData;
        oiVolumeChart.data.datasets[1].data = oiData;
        oiVolumeChart.data.datasets[2].data = volumeData;
        oiVolumeChart.update();
    }
}

// Refresh data every 1 second
setInterval(fetchData, 1000);

</script>

</body>
</html>