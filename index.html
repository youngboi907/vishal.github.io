<!DOCTYPE html>
<html>
<head>
    <title>BTCUSDT Order Book Depth Chart</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>BTCUSDT Order Book Depth Chart (1% & 2.5% around Mid-Price)</h1>
    <div id="chart"></div>

    <script>
        // Sample data (replace with actual order book data)
        const bids = [
            [100.1, 10], 
            [100.05, 5], 
            [100, 8], 
            [99.95, 12], 
            [99.9, 7] 
        ];

        const asks = [
            [100.2, 15], 
            [100.25, 8], 
            [100.3, 10], 
            [100.35, 12], 
            [100.4, 5] 
        ];

        // Calculate mid-price
        const mid_price = (bids[0][0] + asks[0][0]) / 2;

        // Python function (adapted for JavaScript)
        function createOrderBookDepthChart(bids, asks, price_mid) {
            const price_range_1 = [price_mid - 0.01 * price_mid, price_mid + 0.01 * price_mid];
            const price_range_2_5 = [price_mid - 0.025 * price_mid, price_mid + 0.025 * price_mid];

            const filtered_bids_1 = bids.filter(([price, _]) => price >= price_range_1[0] && price <= price_range_1[1]);
            const filtered_asks_1 = asks.filter(([price, _]) => price >= price_range_1[0] && price <= price_range_1[1]);
            const filtered_bids_2_5 = bids.filter(([price, _]) => price >= price_range_2_5[0] && price <= price_range_2_5[1]);
            const filtered_asks_2_5 = asks.filter(([price, _]) => price >= price_range_2_5[0] && price <= price_range_2_5[1]);

            const bid_prices_1 = filtered_bids_1.map(([price, _]) => price);
            const bid_quantities_1 = filtered_bids_1.map(([_, quantity]) => quantity);
            const ask_prices_1 = filtered_asks_1.map(([price, _]) => price);
            const ask_quantities_1 = filtered_asks_1.map(([_, quantity]) => quantity);

            const bid_prices_2_5 = filtered_bids_2_5.map(([price, _]) => price);
            const bid_quantities_2_5 = filtered_bids_2_5.map(([_, quantity]) => quantity);
            const ask_prices_2_5 = filtered_asks_2_5.map(([price, _]) => price);
            const ask_quantities_2_5 = filtered_asks_2_5.map(([_, quantity]) => quantity);

            const trace1 = {
                x: bid_prices_1,
                y: bid_quantities_1,
                type: 'bar',
                name: 'Bids (1%)',
                marker: { color: 'green' }
            };

            const trace2 = {
                x: ask_prices_1,
                y: ask_quantities_1,
                type: 'bar',
                name: 'Asks (1%)',
                marker: { color: 'red' }
            };

            const trace3 = {
                x: bid_prices_2_5,
                y: bid_quantities_2_5,
                type: 'bar',
                name: 'Bids (2.5%)',
                marker: { color: 'lightgreen' }
            };

            const trace4 = {
                x: ask_prices_2_5,
                y: ask_quantities_2_5,
                type: 'bar',
                name: 'Asks (2.5%)',
                marker: { color: 'pink' }
            };

            const data = [trace1, trace2, trace3, trace4];

            const layout = {
                title: 'BTCUSDT Order Book Depth Chart',
                xaxis: { title: 'Price' },
                yaxis: { title: 'Order Quantity' },
                barmode: 'group' 
            };

            Plotly.newPlot('chart', data, layout);
        }

        createOrderBookDepthChart(bids, asks, mid_price); 
    </script>

</body>
</html>
