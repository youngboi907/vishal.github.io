<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Order Book (1-2.5% Range)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }
        h1 {
            margin-bottom: 20px;
        }
        #data-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .data-box {
            background-color: #1e1e1e;
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid #333;
            width: 300px;
            text-align: center;
        }
        .data-box h2 {
            margin: 0 0 10px;
            font-size: 18px;
        }
        .data-box p {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Binance Order Book (1% - 2.5% Range)</h1>
    <div id="data-container">
        <div class="data-box">
            <h2>Sum of Bids (1% to 2.5%)</h2>
            <p id="bids-sum">Loading...</p>
        </div>
        <div class="data-box">
            <h2>Sum of Asks (1% to 2.5%)</h2>
            <p id="asks-sum">Loading...</p>
        </div>
    </div>

    <script>
        async function fetchOrderBook(symbol) {
            const response = await fetch(`https://api.binance.com/api/v3/depth?symbol=${symbol}&limit=1000`);
            if (!response.ok) throw new Error("Failed to fetch order book");
            return response.json();
        }

        async function fetchSpotPrice(symbol) {
            const response = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`);
            if (!response.ok) throw new Error("Failed to fetch spot price");
            const data = await response.json();
            return parseFloat(data.price);
        }

        function calculateSumInRange(orderData, price, rangeStart, rangeEnd) {
            return orderData.reduce((sum, [orderPrice, qty]) => {
                const p = parseFloat(orderPrice);
                const q = parseFloat(qty);
                if (p >= price * (1 + rangeStart / 100) && p <= price * (1 + rangeEnd / 100)) {
                    sum += p * q; // Total value = price * quantity
                }
                return sum;
            }, 0);
        }

        async function updateData() {
            try {
                const symbol = "BTCUSDT";
                const spotPrice = await fetchSpotPrice(symbol);
                const orderBook = await fetchOrderBook(symbol);

                const bidsSum = calculateSumInRange(orderBook.bids, spotPrice, -2.5, -1);
                const asksSum = calculateSumInRange(orderBook.asks, spotPrice, 1, 2.5);

                document.getElementById("bids-sum").textContent = bidsSum.toFixed(2) + " USDT";
                document.getElementById("asks-sum").textContent = asksSum.toFixed(2) + " USDT";
            } catch (error) {
                console.error("Error updating data:", error);
                document.getElementById("bids-sum").textContent = "Error";
                document.getElementById("asks-sum").textContent = "Error";
            }
        }

        setInterval(updateData, 5000); // Update every 5 seconds
        updateData(); // Initial load
    </script>
</body>
</html>