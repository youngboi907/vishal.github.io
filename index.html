<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView with Liquidation Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            overflow: hidden;
        }
        #tv_chart_container {
            position: relative;
            width: 100%;
            height: 60vh; /* Adjust height for TradingView chart */
        }
        #orderBookContainer, #liquidationContainer {
            width: 100%;
            height: 20vh; /* Adjust height for lower sections */
            background-color: #2a2d36; /* Matches TradingView chart background */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
        }
        #orderBookControls, #liquidationControls {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap; /* Ensure controls fit in smaller screens */
        }
        label, input {
            margin: 5px;
            color: white;
        }
        canvas {
            width: 100%;
            height: calc(100% - 40px); /* Adjust canvas height for controls */
        }
        input[type="number"] {
            background-color: #2a2d36;
            color: white;
            border: 1px solid #3a3f4b;
            padding: 5px;
            border-radius: 5px;
        }
        @media (max-width: 768px) {
            #tv_chart_container {
                height: 50vh; /* Adjust chart height for smaller screens */
            }
            #orderBookContainer, #liquidationContainer {
                height: 25vh; /* Adjust heights for smaller screens */
            }
        }
    </style>
</head>
<body>

<!-- TradingView Chart Container -->
<div id="tv_chart_container"></div>

<!-- Order Book Chart Container -->
<div id="orderBookContainer">
    <div id="orderBookControls">
        <label for="minQty">Minimum Quantity (BTC):</label>
        <input type="number" id="minQty" value="0.001" step="0.001" min="0.000001">
    </div>
    <canvas id="orderBookChart"></canvas>
</div>

<!-- Liquidation Data Chart Container -->
<div id="liquidationContainer">
    <h3>Liquidation Data</h3>
    <canvas id="liquidationChart"></canvas>
</div>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script type="text/javascript">
    // Initialize TradingView chart
    window.onload = function () {
        new TradingView.widget({
            "container_id": "tv_chart_container",
            "autosize": true,
            "symbol": "BINANCE:BTCUSDT",
            "interval": "60",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "locale": "en",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "studies": [
                "MAExp@tv-basicstudies",
                "RSI@tv-basicstudies",
                "MACD@tv-basicstudies"
            ],
            "overrides": {
                "movingAverage.length": 200
            },
            "details": true,
            "hotlist": true,
            "calendar": true,
            "withdateranges": true,
            "hide_side_toolbar": false,
        });
    };

    // Order book data variables
    const symbol = "BTCUSDT";
    let minQty = 0.001;
    let orderBook = { bids: [], asks: [] };
    let orderBookChart;

    // Binance WebSocket for order book
    const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol.toLowerCase()}@depth`);
    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        updateOrderBook(data.b, data.a);
        updateOrderBookChart();
    };

    function updateOrderBook(bids, asks) {
        // Update order book logic here (similar to previous)
    }

    function initializeOrderBookChart() {
        const ctx = document.getElementById("orderBookChart").getContext("2d");
        orderBookChart = new Chart(ctx, { /* Chart configuration */ });
    }

    function updateOrderBookChart() {
        // Update chart logic here
    }

    initializeOrderBookChart();

    // Liquidation data variables
    let liquidationChart;

    async function fetchLiquidationData() {
        try {
            const response = await fetch('https://api.binance.com/api/v3/some-liquidation-endpoint');
            const data = await response.json();
            updateLiquidationChart(data);
        } catch (error) {
            console.error("Error fetching liquidation data:", error);
        }
    }

    function initializeLiquidationChart() {
        const ctx = document.getElementById("liquidationChart").getContext("2d");
        liquidationChart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: [], // Placeholder
                datasets: [
                    {
                        label: "Liquidations",
                        data: [],
                        backgroundColor: "rgba(75, 192, 192, 0.6)",
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: { title: { display: true, text: "Time" } },
                    y: { title: { display: true, text: "Amount (USDT)" } },
                },
            },
        });
    }

    function updateLiquidationChart(data) {
        // Parse and update the liquidation data
        liquidationChart.data.labels = data.map(d => d.time); // Example mapping
        liquidationChart.data.datasets[0].data = data.map(d => d.amount);
        liquidationChart.update();
    }

    initializeLiquidationChart();
    setInterval(fetchLiquidationData, 5000); // Refresh liquidation data every 5 seconds
</script>

</body>
</html>